QEMU = @QEMU@ -machine accel=kvm -cpu host
CROSSDIR = @CROSSDIR@
JOBS = 20

default:
	make PATH=$(PATH):$(CROSSDIR) -C hermit
	make PATH=$(PATH):$(CROSSDIR) -C hermit/tools proxy

all: default
	make -j$(JOBS) -C linux

test:
	@echo "Nothing to test"

qemu:
	$(QEMU) -smp 20 -kernel linux/arch/x86/boot/bzImage -initrd config/initrd.cpio -append "root=/dev/ram0 rootfstype=ramfs init=init console=ttyS0 maxcpus=1" -net nic,model=rtl8139 -net user  -net dump -nographic -monitor telnet:127.0.0.1:1234,server,nowait -m 8G -numa node,nodeid=0,cpus=0-4 -numa node,nodeid=1,cpus=5-9 -numa node,nodeid=2,cpus=10-14 -numa node,nodeid=3,cpus=15-19 -cdrom hermit/tools/proxy-image.iso

clean:
	make -C hermit clean

veryclean:
	make -C hermit veryclean
	make -C linux clean

.PHONY: default all clean veryclean test
